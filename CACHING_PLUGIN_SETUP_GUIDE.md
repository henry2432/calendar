# 快取插件安裝指南

## 性能影響估算

根據診斷分析，安裝快取插件可以改進：

| 快取類型 | 改進幅度 | 備註 |
|---------|--------|------|
| **頁面快取** | 400-600ms | 減少 PHP 執行時間 |
| **資料庫快取** | 100-200ms | 減少重複查詢 |
| **物件快取** | 50-100ms | 減少瞬態操作 |
| **CDN 集成** | 200-400ms | 減少 TTFB |
| **總計** | **750-1300ms** | 可達成 **1.3 秒目標** |

## 選項比較

### 選項 1：WP Super Cache（推薦給初級用戶）

**優點：**
- ✅ 簡單易用
- ✅ 低技術門檻
- ✅ 自動快取清除
- ✅ 對 Elementor 支援好

**缺點：**
- ❌ 進階選項較少
- ❌ 只支援靜態頁面快取

**安裝步驟：**

1. **進入 WordPress 後台**
   ```
   https://你的網站/wp-admin
   ```

2. **安裝外掛程式**
   - 外掛程式 → 新增
   - 搜尋「WP Super Cache」
   - 點擊「安裝」→「啟用」

3. **初始設置**
   - 進入「設定」→「WP Super Cache」
   - 勾選「啟用快取」
   - 選擇「簡單」模式（初次使用）
   - 點擊「更新狀態」

4. **進階設置（可選）**
   ```
   WP Super Cache 設定 → 進階標籤
   - ✅ 啟用快取壓縮
   - ✅ 縮小頁面 HTML
   - ✅ 瀏覽器快取
   - ✅ 快取重定向登入
   ```

5. **驗證快取運作**
   - 進入「快取」標籤
   - 確認「快取狀態：已啟用」
   - 檢查「快取大小」逐漸增長

---

### 選項 2：W3 Total Cache（推薦給進階用戶）

**優點：**
- ✅ 功能完整（頁面、DB、物件、瀏覽器快取）
- ✅ CDN 集成（Cloudflare、MaxCDN）
- ✅ 細粒度控制
- ✅ 資料庫查詢最佳化

**缺點：**
- ❌ 設置複雜
- ❌ 可能需要額外設定

**安裝步驟：**

1. **進入 WordPress 後台**
   ```
   https://你的網站/wp-admin
   ```

2. **安裝外掛程式**
   - 外掛程式 → 新增
   - 搜尋「W3 Total Cache」
   - 點擊「安裝」→「啟用」

3. **自動設定**
   - 啟用後會自動出現設定嚮導
   - 選擇「開始設定嚮導」
   - 依序選擇：
     - 頁面快取：✅ 啟用
     - 資料庫快取：✅ 啟用
     - 物件快取：Redis（如可用）或 Memcached
     - 瀏覽器快取：✅ 啟用

4. **性能設定**
   ```
   設定 → W3 Total Cache
   
   一般
   - ✅ 頁面快取：啟用
   - ✅ 資料庫快取：啟用
   - ✅ 物件快取：啟用
   - ✅ 瀏覽器快取：啟用
   - ✅ CDN：啟用（如使用 Cloudflare）
   
   縮小
   - ✅ 啟用 HTML 縮小
   - ✅ 啟用 CSS 縮小
   - ✅ 啟用 JavaScript 縮小
   ```

5. **驗證快取運作**
   - 進入「概述」標籤
   - 確認各類快取均已「已啟用」
   - 檢查「緩衝資料統計」數據

---

## 安裝後檢查清單

### 步驟 1：清除快取
```
設定 → [WP Super Cache 或 W3 Total Cache]
→ 點擊「清除所有快取」
```

### 步驟 2：重新造訪頁面
1. 開啟無痕視窗（Ctrl+Shift+N）
2. 造訪首頁：`https://你的網站`
3. 打開開發工具（F12）

### 步驟 3：驗證快取標頭
在開發工具「Network」標籤：
- 查看首頁請求（HTML）
- 檢查 Response Headers：
  ```
  X-WP-Cache: HIT   ✅ （表示快取已啟用）
  或
  CF-Cache-Status: HIT  ✅ （CloudFlare 快取）
  ```

### 步驟 4：測量載入時間
- **首次造訪（無快取）**：記錄時間
- **刷新（有快取）**：應該快 400-800ms

---

## 與 Elementor 相容性

**重點注意**：
- WP Super Cache：✅ 完全相容
- W3 Total Cache：⚠️ 需要特殊設置

### W3 Total Cache + Elementor 設定

進入「W3 Total Cache → 頁面快取」：
```
排除項目：
✅ 新增：/wp-admin/*
✅ 新增：*/elementor-preview*
✅ 新增：*/edit-post*
✅ 新增：*/wp-json/*

不快取 POST 請求
✅ 保持啟用（保護 Elementor 編輯）
```

---

## 性能改進預期

### 改進時間表

| 階段 | 耗時 | 改進累計 | 備註 |
|------|------|--------|------|
| 起點 | 2-3 秒 | - | Kayarine 代碼優化完成 |
| 移除 Ninja Google Review | 1.8-2.5 秒 | ✅ -100-200ms | 本指南第一部分 |
| 安裝快取插件 | 1.2-1.5 秒 | ✅ -600-1000ms | 本指南 |
| **PHP 8.1+ 升級（可選）** | **1.0-1.3 秒** | **✅ -200-300ms** | 見升級指南 |

---

## 故障排除

### 問題 1：快取未生效（Response 仍顯示 MISS）

**解決步驟：**
1. 檢查快取是否真的啟用
   ```
   WP Super Cache：設定 → 快取狀態應顯示「啟用」
   W3 Total Cache：概述 → 頁面快取應顯示「✓ 已啟用」
   ```

2. 清除所有快取
   ```
   外掛程式設定 → 點擊「清除所有快取」
   ```

3. 等待 5-10 秒重新造訪頁面

4. 檢查服務器日誌
   ```bash
   # SSH 到伺服器
   ssh kayarine.server@104.199.144.122
   tail -f /var/www/html/wp-content/debug.log | grep -i cache
   ```

### 問題 2：Elementor 編輯頁面被快取（無法編輯）

**解決步驟：**
1. 進入快取插件設定
2. 找到「排除項目」或「不快取 URL」
3. 新增：
   - `/wp-admin/*`
   - `*/elementor-preview*`
   - `*/edit-post*`

4. 保存設定並清除快取

### 問題 3：快取導致頁面顯示過期內容

**解決步驟：**
1. 檢查快取有效期
   ```
   W3 Total Cache → 頁面快取 → 快取壽命：3600 秒（1 小時）
   ```

2. 減少快取時間
   ```
   改為 1800 秒（30 分鐘）以獲得最新內容
   ```

3. 啟用「自動清除」
   ```
   發布文章時自動清除相關快取
   ```

---

## 與 CloudFlare 的配合

如果使用 CloudFlare CDN：

### 建議設定
```
在快取插件中設定 CDN：
□ CloudFlare 帳戶登入
□ 授權快取插件存取

在 CloudFlare 儀表板：
□ 快取等級：「快取所有內容」
□ 瀏覽器快取 TTL：1 天
□ 頁面規則：
  - 路徑 /*
  - 快取等級：快取所有內容
  - 瀏覽器快取 TTL：1 天
```

---

## 檢查清單

- [ ] 選擇並安裝快取插件（WP Super Cache 或 W3 Total Cache）
- [ ] 完成初始設置
- [ ] 清除所有快取
- [ ] 驗證快取標頭（X-WP-Cache: HIT）
- [ ] 測量載入時間
- [ ] 記錄改進幅度（秒數）
- [ ] 配置 Elementor 相容性設定
- [ ] 測試編輯頁面功能正常

---

**預計結果**：2-3 秒 → 1.2-1.5 秒（改進 600-1000ms）

**下一步**：升級 PHP 至 8.1+（預計額外節省 200-300ms）
